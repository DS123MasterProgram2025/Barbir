---
title: "Модуль 1. Розділ 4. Лабораторна робота №3. Розвідувальний аналіз даних. Візуалізація"
author: 'Barbir Vladyslav'
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    df_print: paged
  html_notebook:
    toc: true
    toc_float: true
    number_sections: true
editor_options:
  chunk_output_type: inline
encoding: "UTF-8"
---
**Мета:** *Засвоєння принципів, знайомство з інструментами та набуття навичок експлораторного (розвідувального) аналізу даних засобами мови програмування R та колекції пакетів dplyr, ggplot2, desctable, "GGally", "corrplot", "PerformanceAnalytics", "FactoMineR", "factoextra", "funModeling", "desctable", "ade4", "psych", "smacof", "WVPlots", "caret", "car".*.

## Хід роботи

Дано багатовимірний набір даних PimaIndiansDiabetes. Цей датасет походить від Національного інституту діабету, хвороб травлення та нирок і містить дані про 768 жінок племені Піма віком від 21 року. Метою дослідження є прогнозування появи діабету на основі певних діагностичних вимірювань.

Для даного набору виконати розвідувальний аналіз даних. Необхідно дати відповідь на такі питання:

    чи є дані комплектними? з'ясувати характер розподілу змінних.

    чи пов'язані між собою характеристики? якщо пов'язані, то які і як?

    чи існує проста структура, яка дозволяє описати дані об'єкти в просторі розмірністю менш ніж 8? якщо існує -- побудувати таку модель.

    чи є групи пацієнтів (з діабетом та без) однорідними у даному просторі ознак? якщо ні, то виконати сегментацію -- знайти групи з однорідними ознаками.

Результати представити із застосуванням простих і зрозумілих візуалізаторів.

### Виконання завдання

Дані з досліджуваного набору мають наступний вигляд:
```{r}
library(mlbench)
library(tibble)

data(PimaIndiansDiabetes)
diabetes_orig <- as_tibble(PimaIndiansDiabetes)

diabetes_orig |> 
  head()
```

Обчислимо і дослідимо сумарні статистики.
```{r}
diabetes_orig |> 
  summary()
```
Що ми бачимо?

    Всі дані, крім цільової змінної diabetes, мають числову природу.

    Дані комплектні: формально відсутні пропущені значення (NA).

    Наявні нульові значення: у змінних glucose, pressure, triceps, insulin та mass присутні нулі. З медичної точки зору, нульові значення для цих показників є неможливими (наприклад, нульовий тиск чи індекс маси тіла).Це свідчить про те, що нулі, ймовірно, використовуються для кодування відсутніх даних.Цей факт потребує уваги на етапі підготовки даних для моделювання, але в рамках розвідувального аналізу ми залишимо їх, щоб побачити їхній вплив на розподіли.

    Відсутні надвеликі значення, що потребували б окремого аналізу.

    По всіх змінних дані мають значну варіацію.

Дослідимо закони розподілу кожної з восьми змінних. Для цього побудуємо гістограми для кожної з числових змінних.
```{r}
library(tidyverse)
diabetes_orig |>
  select(-diabetes) |>
  pivot_longer(cols = everything()) |>
  ggplot(aes(x = value)) +
  geom_histogram(aes(y = after_stat(density)), 
                 fill = "lightblue", 
                 color = "dark grey",
                 bins = 30) +
  geom_density(color = "red") +
  facet_wrap(~name, scales = "free") +
  theme_minimal() +
  labs(x = "Значення", y = "Відносна частота")
```


Що ми бачимо?

    Розподіли змінних glucose та pressure нагадують дзвоноподібну форму, що є близькою до нормального розподілу, хоча й з деякою асиметрією. Наявність нулів дещо спотворює ці розподіли.

    Розподіли змінних pregnant, insulin, triceps, pedigree, та age є сильно асиметричними (скошеними вправо). Це вказує на те, що більшість спостережень мають низькі значення цих показників, але існують і значно вищі, хоча й рідкісні, значення.

    Висока частота нульових значень для insulin та triceps підтверджує припущення, що це, ймовірно, закодовані пропущені дані.


Для відповіді на питання, чи пов'язані між собою змінні, застосуємо кореляційний аналіз. З урахуванням числової природи даних, для оцінки кореляції скористаємося коефіцієнтом кореляції Пірсона.

```{r}
library(corrplot)
diabetes_orig |>
  select(-diabetes) |>
  cor() |>
  corrplot(order = "hclust", tl.col='black', tl.cex=.75)

```

Також побудуємо матрицю діаграм розсіювання, щоб візуально оцінити зв'язки між змінними, розфарбувавши точки відповідно до наявності діабету.

```{r}
pairs(diabetes_orig |> select(-diabetes), 
      main="Матриця діаграм розсіювання для Pima Indians Diabetes", 
      pch=21, 
      bg=c("green3", "red3")[unclass(diabetes_orig$diabetes)])
```


Що ми бачимо?

    Існує помітний позитивний кореляційний зв'язок між змінними:

        age та pregnant (вік та кількість вагітностей) — що є логічним.

        mass та triceps (індекс маси тіла та товщина шкірної складки).

        glucose та insulin (рівень глюкози та інсуліну).

    На кореляційних полях видно, що групи пацієнтів з діабетом (red3) та без (green3) частково перекриваються, але мають різні центри розподілу. Наприклад, на діаграмі glucose проти age видно, що пацієнти з діабетом частіше мають вищі показники глюкози в будь-якому віці.

    Слабкі кореляції між іншими змінними свідчать про те, що вони несуть унікальну інформацію.
    

Наявність кореляцій дає підстави припустити, що можна знизити розмірність простору ознак. Для цього скористаємося методом головних компонент (PCA).

```{r}
library(FactoMineR)
library(factoextra)

resPCA <- diabetes_orig |> 
  select(-diabetes) |>
  PCA(graph = FALSE, scale.unit = TRUE)
```



```{r}
eigenvalues <- as.data.frame(resPCA$eig)
knitr::kable(
  eigenvalues, 
  caption = "Власні значення (eigenvalues) і сумарний процент поясненої дисперсії"
)
```



```{r}
fviz_screeplot(resPCA, addlabels = TRUE)
```

Що ми бачимо?
Перші три головні компоненти пояснюють майже 65% загальної дисперсії даних. Це означає, що ми можемо скоротити розмірність з 8 до 3 змінних, втративши при цьому лише близько 35% інформації. Це є суттєвим спрощенням моделі. Проаналізуємо структуру перших двох компонент.


```{r}
knitr::kable(
  resPCA$var$coord[, 1:2], 
  caption = "Таблиця навантажень"
)
```

Що ми бачимо?

    Перша головна компонента (Dim.1) має сильні позитивні навантаження від age, mass, glucose, triceps та pregnant. Її можна інтерпретувати як "компоненту метаболічного здоров'я та віку".

    Друга головна компонента (Dim.2) має сильні позитивні навантаження від insulin та pedigree і від'ємне від pressure. Вона відображає переважно інсулінову реакцію та генетичну схильність.


Тепер візуалізуємо пацієнтів у просторі перших двох головних компонент, щоб побачити, чи утворюють вони окремі кластери.


```{r}
fviz_pca_biplot(resPCA,
                geom = "point",
                habillage = diabetes_orig$diabetes,
                addEllipses = TRUE,
                ellipse.level = 0.95,
                palette = c("#00AFBB", "#FC4E07"),
                repel = TRUE) +
  theme_minimal() +
  labs(title = "PCA для датасету Pima Indians Diabetes",
       color = "Діабет",
       shape = "Діабет")
```

Таким чином, з'ясовано, що початкові дані не є однорідними. Групи пацієнток з діабетом та без нього відрізняються за сукупністю ознак. Хоча кластери значно перекриваються, що свідчить про складність проблеми, їхні центри (еліпси) чітко зміщені один відносно одного у просторі головних компонент. Група з діагнозом "діабет" (pos) в середньому зміщена вправо по першій компоненті, що вказує на вищі значення віку, маси тіла, глюкози та кількості вагітностей. Завдяки наявності кореляцій у початкових змінних, дані вдалося представити у просторі меншої розмірності. Знайдені відмінності між групами можуть бути використані для побудови класифікатора з метою діагностики діабету у нових пацієнтів.

## References
1. James, G., Witten, D., Hastie, T., & Tibshirani, R. (2023). *An Introduction to Statistical Learning: with Applications in R (3rd ed.)*. Springer.  
2. Wickham, H., & Grolemund, G. (2017). *R for Data Science: Import, Tidy, Transform, Visualize, and Model Data*. O’Reilly Media.  
3. Kuhn, M., & Silge, J. (2022). *Tidy Modeling with R*. O’Reilly Media.  
4. Han, J., Pei, J., & Kamber, M. (2022). *Data Mining: Concepts and Techniques (4th ed.)*. Morgan Kaufmann.  

